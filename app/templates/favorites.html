{% extends "base.html" %}
{% block body %}

<section class="container my-5">
  <h3 class="mb-4">❤️ My Favorites</h3>

  {% if products %}
    <div class="row g-4">
      {% for p in products %}
        <div class="col-md-3">
          <div class="card h-100 shadow-sm">
            <!-- Product image -->
            {% if p.main_image %}
              <img src="{{ url_for('static', filename='uploads/'~p.main_image) }}" class="card-img-top" alt="{{ p.name }}">
            {% else %}
              <img src="{{ url_for('static', filename='placeholder.png') }}" class="card-img-top" alt="No image">
            {% endif %}

            <div class="card-body text-center">
              <!-- Product name -->
              <h6 class="card-title">{{ p.name }}</h6>

              <!-- Price -->
              <p class="text-muted mb-1">
                ${{ '%.2f'|format(p.price) }}
                {% if p.discount_price %}
                  <span class="text-success fw-bold ms-1">
                    {{ '%.0f'|format(p.discount_price / p.price * 100) }}% Off
                  </span>
                {% endif %}
              </p>

              <!-- Average rating -->
              {% set avg_rating = p.ratings|map(attribute='stars')|sum / (p.ratings|length if p.ratings|length>0 else 1) %}
              <div class="mb-2 text-warning">
                {% for i in range(1,6) %}
                  {% if i <= avg_rating %}
                    ★
                  {% else %}
                    ☆
                  {% endif %}
                {% endfor %}
                <span class="text-dark ms-1">({{ p.ratings|length }})</span>
              </div>

              <!-- Buttons -->
              <div class="d-flex justify-content-center gap-2">
                <a href="{{ url_for('product_detail', product_id=p.id) }}" class="btn btn-primary btn-sm">View</a>
                <a href="{{ url_for('toggle_favorite', product_id=p.id) }}" class="btn btn-outline-danger btn-sm">Remove ❤️</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">
      You have no favorite products yet. Browse products and add them to your favorites!
    </div>
  {% endif %}

</section>

<style>
.card-img-top {
  height: 180px;
  object-fit: cover;
  transition: transform 0.3s;
}
.card-img-top:hover { transform: scale(1.05); }
</style>

{% endblock %}
